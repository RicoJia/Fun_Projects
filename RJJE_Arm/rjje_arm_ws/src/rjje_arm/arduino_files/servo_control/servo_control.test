#include "servo_control.h"
#define INTERCEPT -46.3003
#define SLOPE 0.4580

static Motor motors[6]; 
static float commanded_angles[6] = {180, 90, 90, 90, 90, 90};

Adafruit_PWMServoDriver pwm = Adafruit_PWMServoDriver(PWM_BOARD_ADDR); 

void setup()
{
  Serial.begin(9600); //comment out ros node stuff if using this

  pwm.begin();
  pwm.setOscillatorFrequency(27000000);
  pwm.setPWMFreq(SERVO_FREQ);  // Analog servos run at ~50 Hz updates
  pinMode(A0, INPUT_PULLUP); 
  delay(5000); 
  
  /* motors[0].flip_rotation_ = true; */
}

void servo_read(){
      int val = analogRead(A0);
      double measured = SLOPE * val + INTERCEPT; 
      Serial.println(" |measured: " + String(measured)); 
      delay(300);  
}

void loop()
{
  
  for (int i = 0; i <=180; i+=3) {
      motors[0].set_angle(i, 0, pwm);
      delay(500);  
      servo_read();
      /* int val = analogRead(A0); */
      /* Serial.println(" sent: " + String(i)+" |measured: " + String(val));  */
  }

    for (int i = 180; i >= 0; i-=3) {
      motors[0].set_angle(i, 0, pwm);
      delay(500);  
      servo_read();
      /* int val = analogRead(A0); */
      /* Serial.println(" sent: " + String(i)+" |measured: " + String(val));  */
  }


}

